
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  
  <style>
    #container {
      width: 500px;
      height: 500px;
      overflow: hidden;
      position: relative;
      background: #eee;
      display: inline-block;
      margin-right: 20px;
    }
    #_debug {
      position: absolute;
      left: 520px;
      top: 8px;
      height: 500px;
      display: inline-block;
      max-height: 700px;
      overflow-y: scroll;
    }
    
    .box {
      float: left;
      margin: 20px 0 0 20px;
      width: 100px;
      height: 100px;
      overflow: hidden;
      opacity: .7;
      -webkit-transition: -webkit-transform .1s;
    }
    
    .draggable {
      position: absolute;
      float: none;
    }
    
    .box1 { left: 0; top: 0; background: blue; }
    .box2 { left: 120px; top: 0; background: red; }
    .box3 { left: 240px; top: 0; background: green; }
    .box4 { left: 360px; top: 0; background: orange; }
  </style>
</head>

<body>

<div id="container">
  <div class="box box1 holdable"></div>
  <div class="box box2 holdable"></div>
  <div class="box box3 holdable"></div>
  <div class="box box4 holdable"></div>
</div>

  <div id="_debug">debug</div>

<script src="js/hammer.js"></script>
<script>
  function hasClass(ele,cls) {
  	return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
  }
  function addClass(ele,cls) {
  	if (!this.hasClass(ele,cls)) ele.className += " "+cls;
  }
  function removeClass(ele,cls) {
  	if (hasClass(ele,cls)) {
  		var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
  		ele.className=ele.className.replace(reg,' ');
  	}
  }

  var debug_el = document.getElementById("_debug");
  function debug(str) {
    debug_el.innerHTML += " "+ str.toString();
    debug_el.scrollTop = debug_el.scrollHeight;
  }

  /**
   * setup hammer
   */
  var el = document.getElementById('container');

  var hammer = new Hammer(el, {
    drag_min_distance: 0,
    drag_horizontal: true,
    drag_vertical: true,
    transform: false,
    prevent_default: true
  });

  var container_size = el.getBoundingClientRect();

  var drag = {};

  var drag_el;
  var drag_el_size = {};
  var drag_timer;
  var drag_pos = {};
  var zIndex = 10;
  var draggableClassName = "draggable";
  var tappableClassName = "tappable";
  var holdableClassName = "holdable"; // allows "hold to pick up"

  /**
   * keep up dragging
   */
  function watchDrag()
  {
    if(!drag.length) {
      return;
    }

    for(var d = 0; d<drag.length; d++) {
      var left = drag[d].pos.x - (drag[d].size.width / 2);
      var top = drag[d].pos.y - (drag[d].size.height / 2);

      if(left < 0) {
        left = 0;
      }
      if(top < 0) {
        top = 0;
      }

      if(left > container_size.width - drag[d].size.width) {
        left = container_size.width - drag[d].size.width;
      }
      if(top > container_size.height - drag[d].size.height) {
        top = container_size.height - drag[d].size.height;
      }

      drag[d].el.style.left = left +'px';
      drag[d].el.style.top = top +'px';
    }
  }

  /**
   * on tap
   */
  hammer.ontap = function(ev) {
    debug("tap<br>");
    var touches = ev.originalEvent.touches || [ev.originalEvent];
    for(var t=0; t<ev.touches.length; t++) {
      var el = touches[t].target;

      if(hasClass(el,tappableClassName)) {
        el.style.zIndex = zIndex++;
      }
    }
  };

  
  /**
   * on hold
   */
  hammer.onhold = function(ev) {
    var touches = ev.originalEvent.touches || [ev.originalEvent];
    var el = touches[0].target;
    addClass(el,draggableClassName);
    el.style.zIndex = zIndex++;
    debug("hold "+el.id+"<br>");
  }
  
  /**
   * on release
   */
  hammer.onrelease = function(ev) {
    debug("release<br>");
    var draggables = document.getElementsByClassName(draggableClassName);
    for (var i=0; i<draggables.length; i++) {
      removeClass(draggables[i],draggableClassName);
    }
  }
  
  /**
   * on drag
   */
  hammer.ondrag = function(ev) {
    drag = [];
    var touches = ev.originalEvent.touches || [ev.originalEvent];
    for(var t=0; t<touches.length; t++) {
      var el = touches[t].target;

      if(hasClass(el,draggableClassName)) {
        drag.push({
          el: el,
          size: { width: 100, height: 100 },
          pos: ev.touches[t]
        });
      }
    }
  };


  setInterval(watchDrag, 10);

</script>
</body>
</html>
